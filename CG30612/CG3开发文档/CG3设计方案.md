# CG3 实验设计方案

版权声明：本程序代码完全由我本人编写，没有从任何网站复制任何代码。



如果要是只画一个斜二测的正方体然后转一转是不是有点无聊啊。

我打算设计一个 3D 地图的渲染器来使用 GDI 绘制一个透视投影的 3D 地图（当然了，里面那个正方体还是在的）。

## 地图概述

坐标原点处放置着一个大正方体，大正方体上表面中心有一个旋转的小正方体，程序使用者可以通过 WASD 改变玩家观察的视角从而观察这个小正方体。

## 三维坐标表示

正方体的坐标：

- 位置向量；
- 正面向量；
- 左面向量；
- 不存储上面向量，上面向量可以通过正面向量和左面向量叉积得到。

程序使用者位置的表示：

- 程序使用者到原点距离始终不变；
- 使用者只记录一个位置向量，使用 AD 左右转动镜头，WS 上下转动镜头，投影面垂直于这一向量；
- 向上转动不得超过俯视，向下转动不能超过仰视，转动过程中镜头不会上下颠倒。

## 几种坐标

- 空间三维坐标：描述一个集合体在空间中的位置，单位长度为逻辑单位；
- 平面三维坐标：本质上是空间三维坐标的特例，就是将一个空间三维坐标透视投影到投影面上的结果，单位长度为逻辑单位；
- 平面二维坐标：投影面上的逻辑坐标系，y 向上，x 向右，坐标原点位于客户区中点，单位长度为逻辑单位；
- 设备二维坐标：用于输出图形，单位长度为一个像素。

## 施工计划

1. 实现平面二维坐标到设备二维坐标的变换；
2. 实现观察者与大正方体的三维坐标表示，以及到二维坐标的变换；
3. 实现小正方体的三维坐标表示，以及其关于时间的旋转；
3. 显示物体轮廓边框；
4. 实现 z 缓冲填充算法， 完工。

### 第一阶段：平面二维坐标到设备二维坐标的变换

设平面二维坐标为 $(x', y')$，设备二维坐标为 $(x, y)$ 则在逻辑单位下，有：
$$
x=x'+\frac{w}{2}\\
y=\frac{h}{2}-y'
$$
其中 $w$ 为客户区宽度（逻辑单位），$h$ 为客户区高度（逻辑单位）。

逻辑单位和像素单位的换算是：
$$
1\;LogicUnit=1000\;Pixels
$$

## 额外补充功能

2022-12-17 额外补充了选择投影方式的功能，可供选择的投影方式为平行投影和透视投影。由于平行投影得到的投影结果一般会比透视投影大，因此我们约定在平行投影功能中$1\;LogicUnit=131.25\;Pixels$。

